{% extends "base/base.html.twig" %}

{% block title %}{{ parent() }}Panel - {{ app.user.email }}{% endblock %}
{% block body %}
<div class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-md-12 w-100 h-25" id="logo-image"></div>
        </div>
    </div>
</div>
<div class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-md-12">

                <h2 class="text-center">Logged as: {{ app.user.email }} | <a href="{{ path('app_logout') }}">logout</a></h2>
            </div>
        </div>
    </div>
</div>
<div class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                    <a class="nav-link active" id="v-pills-profile-tab" data-toggle="pill" href="#v-pills-profile" role="tab" aria-controls="v-pills-profile" aria-selected="true">Profile Details</a>
                    <a class="nav-link" id="v-pills-fav-tab" data-toggle="pill" href="#v-pills-fav" role="tab" aria-controls="v-pills-fav" aria-selected="false">Fav Restaurants</a>
                    <a class="nav-link" id="v-pills-restaurant-tab" data-toggle="pill" href="#v-pills-restaurant" role="tab" aria-controls="v-pills-restaurant" aria-selected="false">Restaurant details</a>
                    <a class="nav-link" id="v-pills-menu-tab" data-toggle="pill" href="#v-pills-menu" role="tab" aria-controls="v-pills-menu" aria-selected="false">Restaurant menu</a>
                </div><br><br><br><br><br>

            </div>
            <div class="col-md-8" style="text-align: center;">
                <div class="tab-content" id="v-pills-tabContent">
                    <div class="tab-pane fade show active" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab">
                        <h2>Profile Details</h2>
                        <p><a href="{{ path('app_edit_profile') }}">Edit profile</a></p>
                        <hr><br><br>
                        <h5>User name:</h5>
                        <p>{{ app.user.email }}</p>
                        <h5>Password:</h5>
                        <p>Your password is hashed in bcrypt algorithm</p>
                        <h5>Restaurant owner?</h5>
                        <p>{% if app.user.hasRestaurant %} Yes {% else %} No {% endif %}</p>
                    </div>

                    {% block fav_restaurants %}{% include 'panel/fav_restaurants.html.twig' %}{% endblock %}

                    <div class="tab-pane fade" id="v-pills-restaurant" role="tabpanel" aria-labelledby="v-pills-restaurant-tab">
                        <h2>Restaurant details</h2><hr><br><br>
                        {% if app.user.hasRestaurant and app.user.restaurantId %}
                            }
                            else {                                  //Restaurant details code
                            $restaurantID = $row["restaurantID"];
                            $sql = 'SELECT * from restaurant
                            WHERE id = '.$restaurantID.';
                            ';

                            $result = $conn->query($sql);
                            $row = $result->fetch_assoc();
                            $sql2 = '
                            SELECT name
                            FROM cuisine
                            WHERE id = '.$row["cuisineID"].'
                            ';
                            $result2 = $conn->query($sql2);
                            $row2 = $result2->fetch_assoc();

                            echo '
                            <p><a class="btn btn-primary" href="editrestaurant.php" role="button">Edit restaurant details</a></p>
                            <br><br><br>
                            <h5>Restaurant name:</h5>
                            <p>'.$row["name"].'</p>
                            <h5>Logo:</h5>
                            <p><img class="img-fluid d-block rounded-circle mx-auto w-25" src="'.$row["image"].'" width="100" height="100" alt="'.$row["name"].'"></p><br>
                            <h5>Cuisine:</h5>
                            <p>'.$row2["name"].'</p>
                            <h5>Lat:</h5>
                            <p>'.$row["lat"].'</p>
                            <h5>Lng:</h5>
                            <p>'.$row["lng"].'</p>
                            <h5>Delivery time:</h5>
                            <p>'.$row["deliveryTime"].'</p>
                            <h5>Delivery cost:</h5>
                            <p>'.$row["deliveryCost"].'</p>
                            <h5>Minimal order:</h5>
                            <p>'.$row["minimalOrder"].'</p>
                            <h5>Website:</h5>
                            <p>'.$row["website"].'</p>
                            <h5>Email:</h5>
                            <p>'.$row["email"].'</p>
                            <h5>Mobile number:</h5>
                            <p>'.$row["mobile"].'</p><br><br>
                            <p><a href="deleterestaurant.php?id='.$restaurantID.'" onclick="return askForConfirm()">Delete this restaurant</a></p>
                        {% else %}
                        <div class="alert alert-danger">Actually you dont have any registred restaurant. Fill this form to add new restaurant.</div><br><br><br><br>
                        ';
                        echo ' <form id="addrestaurant" name="addrestaurant" action="addrestaurantproceed.php" method="post" style="width: 50%; margin-left: 25%; margin-right:25%;">

                            <div class="form-group"> <label>Restaurant name</label> <input type="text" class="form-control" value="" name="restaurantName" id="restaurantName"  maxlength="140" required>  </div>
                            <div class="form-group"> <label>Link to image (with ex. http://image.com/image.jpg)</label> <input type="url" class="form-control" value="" name="imageLink" id="imageLink" required>  </div>
                            <div class="form-group"> <label>Cuisine</label><br>
                                <select name="cuisine" id="cuisine" size="3" style="width: 100%" required>
                                    <option value=0>american</option>
                                    <option value=1>italian</option>
                                    <option value=2>japanese</option>
                                    <option value=3>british</option>
                                    <option value=4>indian</option>
                                    <option value=5>chinese</option>
                                    <option value=6>other</option>
                                </select>
                            </div>
                            <div class="form-group"> <label>Lat</label> <input type="text" class="form-control" value="" name="lat" id="lat" maxlength="30" required>  </div>
                            <div class="ford group">
                                <label>Too se what is localization of your restaurant (lat and lng) <a href="https://www.latlong.net/" target="_blank">click here</a></label><br><br></div>
                            <div class="form-group"> <label>Lng</label> <input type="text" class="form-control" value="" name="lng" id="lng"  maxlength="30" required>  </div>
                            <div class="ford group">
                                <label>Too se what is localization of your restaurant (lat and lng) <a href="https://www.latlong.net/" target="_blank">click here</a></label><br><br></div>
                            <div class="form-group"> <label>Delivery time</label> <input type="number" class="form-control" value="" name="deliveryTime" id="deliveryTime" min="1" max="200" title="Rage: 1-200" required>  </div>
                            <div class="form-group"> <label>Delivery cost</label> <input type="number" class="form-control" value="" name="deliveryCost" id="deliveryCost" min="0" max="50" title="Rage: 0-50" required>  </div>
                            <div class="form-group"> <label>Minimal order</label> <input type="number" class="form-control" value="" name="minimalOrder" id="minimalOrder" min="0" max="50" required>  </div>
                            <div class="form-group"> <label>Website</label> <input type="url" class="form-control" value="" name="website" id="website" required>  </div>
                            <div class="form-group"> <label>Email</label> <input type="email" class="form-control" name="email" id="email" value="
            '; echo $_SESSION["user"];

                                echo '
                                " readonly required>  </div>
                            <div class="form-group"> <label>Mobile</label> <input type="tel" class="form-control" value="" name="mobile" id="mobile" required>  </div>
                            <button type="submit" class="btn btn-primary">Add restaurant</button>
                        </form>

                        {% endif %}

                    </div>
                    <div class="tab-pane fade" id="v-pills-menu" role="tabpanel" aria-labelledby="v-pills-menu-tab">
                        <h2>Restaurant menu</h2><hr><br><br>
                        {% if app.user.hasRestaurant == false %}
                        <p>This section is available for restaurant owners only. You can change it in profile edit section.</p>
                        {% elseif app.user.restaurantId == '' or app.user.restaurantId == null %}
                        <p>You have to add restaurant first, in restaurant details section!</p>
                        {% else %}
                            <a class="btn btn-primary" href="addmenuitem.php" role="button">+ add new menu item</a><br><br><br>';
                            <div class="col-md-12" style="overflow-y: scroll; max-height: 1000">
                            <div class="table-responsive">
                                <table class="table table-striped table-borderless">
                                    <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Meal name</th>
                                        <th scope="col">Ingredients</th>
                                        <th scope="col">Price</th>
                                        <th scope="col">Action</th>
                                    </tr>
                                    </thead>
                                    <tbody>';

                                    $sql = "
                                    SELECT * FROM menuitem
                                    WHERE restaurantID = ".$restaurantID.";
                                    ";
                                    $result = $conn->query($sql);

                                    if ($result->num_rows > 0) {
                                    // output data of each row
                                    $i = 1;
                                    while($row = $result->fetch_assoc()) {
                                    echo '
                                    <tr>
                                        <th scope="row"> '.$i.' </th>
                                        <td>'.$row["name"].'</td>
                                        <td>'.$row["ingredients"].'</td>
                                        <td>£'.$row["price"].'</td>
                                        <td><a href="editmenuitem.php?id='.$row["id"].'">Edit</a> | <a href="deletemenuitem.php?id='.$row["id"].'">Delete</a></td>
                                    </tr>
{#                                    todo if has no items, display this:#}
                                    else echo 'You dont have any menu items. Please add some first!';
                                    </tbody>
                                </table>
                            </div>
                                {% endif %}
                        </div>
                    </div>
                </div></div>
        </div>
    </div>
</div>
{% endblock %}